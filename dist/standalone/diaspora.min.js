/**
* @file diaspora
*
* Multi-Layer ORM for Javascript Client+Server
* Standalone build compiled on 2017-11-07 17:24:11
*
* @license GPL-3.0
* @version 0.2.0-rc.3
* @author Gerkin
*/
function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _get=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},_slicedToArray=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Diaspora=e()}}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";var r=e("./lib/diaspora");t.exports=r},{"./lib/diaspora":10}],2:[function(e,t,n){"use strict";var r=e("../../dependencies")._;t.exports={OPERATORS:{$exists:function(e,t){return t===!r.isUndefined(e)},$equal:function(e,t){return!r.isUndefined(e)&&e===t},$diff:function(e,t){return!r.isUndefined(e)&&e!==t},$less:function(e,t){return!r.isUndefined(e)&&e<t},$lessEqual:function(e,t){return!r.isUndefined(e)&&e<=t},$greater:function(e,t){return!r.isUndefined(e)&&e>t},$greaterEqual:function(e,t){return!r.isUndefined(e)&&e>=t}},CANONICAL_OPERATORS:{"~":"$exists","==":"$equal","!=":"$diff","<":"$less","<=":"$lessEqual",">":"$greater",">=":"$greaterEqual"},QUERY_OPTIONS_TRANSFORMS:{limit:function(e){var t=e.limit;if(r.isString(t)&&(t=parseInt(t)),!r.isInteger(t)&&isFinite(t))throw new TypeError('Expect "options.limit" to be a integer');if(t<0)throw new RangeError('Expect "options.limit" to be an integer equal to or above 0, have '+t);e.limit=t},skip:function(e){var t=e.skip;if(r.isString(t)&&(t=parseInt(t)),!r.isInteger(t)&&isFinite(t))throw new TypeError('Expect "options.skip" to be a integer');if(!isFinite(t)||t<0)throw new RangeError('Expect "options.skip" to be a finite integer equal to or above 0, have '+t);e.skip=t},page:function(e){if(!e.hasOwnProperty("limit"))throw new ReferenceError('Usage of "options.page" requires "options.limit" to be defined.');if(!isFinite(e.limit))throw new RangeError('Usage of "options.page" requires "options.limit" to not be infinite');if(e.hasOwnProperty("skip"))throw new ReferenceError('Use either "options.page" or "options.skip"');var t=e.page;if(r.isString(t)&&(t=parseInt(t)),!r.isInteger(t)&&isFinite(t))throw new TypeError('Expect "options.page" to be a integer');if(!isFinite(t)||t<0)throw new RangeError('Expect "options.page" to be a finite integer equal to or above 0, have '+t);e.skip=t*e.limit,delete e.page}}}},{"../../dependencies":9}],3:[function(e,t,n){"use strict";var r=e("../../dependencies"),i=r._,o=r.Promise,a=r.SequentialEvent,s=function(e,t){var n=[],r=0,a=e.skip;return function s(u){return i.isNil(u)?o.resolve(n):(!0!==u&&n.push(u),r===e.limit?o.resolve(n):(e.skip=a+r,r++,t(e).then(s)))}},u=e("./adapter-utils"),c=u.OPERATORS,l=u.CANONICAL_OPERATORS,f=u.QUERY_OPTIONS_TRANSFORMS,d=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.state="preparing",n.remaps={},n.remapsInverted={},n.filters={},n.classEntity=e,n.error=void 0,n.on("ready",function(){n.state="ready"}).on("error",function(e){n.state="error",n.error=e}),n}return _inherits(t,a),_createClass(t,[{key:"configureCollection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.remaps[e]={normal:t,inverted:i.invert(t)},this.filters[e]=n}},{key:"waitReady",value:function(){var e=this;return new o(function(t,n){return"ready"===e.state?t(e):"error"===e.state?n(e.error):void e.on("ready",function(){return t(e)}).on("error",function(e){return n(e)})})}},{key:"remapInput",value:function(e,t){return this.remapIO(e,t,!0)}},{key:"remapOutput",value:function(e,t){return this.remapIO(e,t,!1)}},{key:"remapIO",value:function(e,t,n){var r=this;if(i.isNil(t))return t;var o=!0===n?"input":"output",a=i.mapValues(t,function(t,n){var a=i.get(r,["filters",e,o,n],void 0);return i.isFunction(a)?a(t):t}),s=!0===n?"normal":"inverted";return i.mapKeys(a,function(t,n){return i.get(r,["remaps",e,s,n],n)})}},{key:"setIdHash",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return e.idHash=i.assign({},e.idHash,_defineProperty({},this.name,e[t])),e}},{key:"matchEntity",value:function(e,t){return i.every(i.toPairs(e),function(e){var n=_slicedToArray(e,2),r=n[0],o=n[1];if(i.isObject(o)){var a=t[r];return i.every(o,function(e,t){return!!c.hasOwnProperty(t)&&c[t](a,e)})}return!1})}},{key:"normalizeOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e=i.cloneDeep(e),i.forEach(f,function(t,n){e.hasOwnProperty(n)&&f[n](e)}),i.defaults(e,{skip:0,remapInput:!0,remapOutput:!0}),e}},{key:"normalizeQuery",value:function(e,t){return!0===t.remapInput?i(i.cloneDeep(e)).mapValues(function(e){return i.isUndefined(e)?{$exists:!1}:e instanceof Object?(e=i.mapKeys(e,function(e,t,n){if(l.hasOwnProperty(t)){if(n.hasOwnProperty(l[t]))throw new Error("Search can't have both \""+t+'" and "'+l[t]+'" keys, as they are synonyms');return l[t]}return t}),i.forEach(["$less","$lessEqual","$greater","$greaterEqual"],function(t){if(e.hasOwnProperty(t)&&!i.isNumber(e[t]))throw new TypeError('Expect "'+t+'" in '+JSON.stringify(e)+" to be a numeric value")}),e):{$equal:e}}).value():i.cloneDeep(e)}},{key:"insertOne",value:function(e,t){return this.insertMany(e,[t]).then(function(e){return o.resolve(i.first(e))})}},{key:"insertMany",value:function(e,t){var n=this;return o.mapSeries(t,function(t){return n.insertOne(e,t||{})})}},{key:"findOne",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.limit=1,this.findMany(e,t,n).then(function(e){return o.resolve(i.first(e))})}},{key:"findMany",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=this.normalizeOptions(n),s(n,this.findOne.bind(this,e,t))(!0)}},{key:"updateOne",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r=this.normalizeOptions(r),r.limit=1,this.updateMany(e,t,n,r).then(function(e){return o.resolve(i.first(e))})}},{key:"updateMany",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r=this.normalizeOptions(r),s(r,this.updateOne.bind(this,e,t,n))(!0)}},{key:"deleteOne",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.limit=1,this.deleteMany(e,t,n)}},{key:"deleteMany",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=0;return function s(){return n.findOne(e,t,r).then(function(u){return i.isNil(u)?o.resolve():a===r.limit?o.resolve():(a++,n.deleteOne(e,t,r).then(s))})}()}}]),t}();t.exports=d},{"../../dependencies":9,"./adapter-utils":2}],4:[function(e,t,n){"use strict";var r=e("../../dependencies")._,i=function(){function e(t,n){if(_classCallCheck(this,e),!r.isNil(t)){if(r.isNil(n))throw new TypeError('Expect 2nd argument to be the parent of this entity, have "'+n+'"');Object.defineProperties(this,{dataSource:{value:n,enumerable:!1,configurable:!1}}),r.assign(this,t)}}return _createClass(e,[{key:"toObject",value:function(){return r.omit(this,["dataSource","id"])}}]),e}();t.exports=i},{"../../dependencies":9}],5:[function(e,t,n){"use strict";var r=e("../../dependencies"),i=r._,o=r.Promise,a=e("../../utils"),s=e("../../diaspora").components.Adapters.Adapter,u=e("./entity.js"),c=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,u));return e.state="ready",e.store={},e}return _inherits(t,s),_createClass(t,[{key:"configureCollection",value:function(e,n){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"configureCollection",this).call(this,e,n),this.ensureCollectionExists(e)}},{key:"ensureCollectionExists",value:function(e){return this.store.hasOwnProperty(e)?this.store[e]:this.store[e]={items:[]}}},{key:"insertOne",value:function(e,t){t=i.cloneDeep(t);var n=this.ensureCollectionExists(e);return t.id=a.generateUUID(),this.setIdHash(t),n.items.push(t),o.resolve(new this.classEntity(t,this))}},{key:"findOne",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.ensureCollectionExists(e),s=i.filter(r.items,i.partial(this.matchEntity,t)),u=a.applyOptionsToSet(s,n);return o.resolve(u.length>0?new this.classEntity(i.first(u),this):void 0)}},{key:"findMany",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=this.ensureCollectionExists(e),u=i.filter(s.items,i.partial(this.matchEntity,t)),c=a.applyOptionsToSet(u,r);return o.resolve(i.map(c,function(e){return new n.classEntity(e,n)}))}},{key:"updateOne",value:function(e,t,n){var r=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.findOne(e,t,s).then(function(t){if(i.isNil(t))return o.resolve();var s=r.ensureCollectionExists(e),u=i.find(s.items,{id:t.id});return a.applyUpdateEntity(n,u),o.resolve(new r.classEntity(u,r))})}},{key:"updateMany",value:function(e,t,n){var r=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.findMany(e,t,s).then(function(t){if(!i.isNil(t)&&t.length>0){var s=r.ensureCollectionExists(e),u=i.map(t,"id"),c=i.filter(s.items,function(e){return-1!==u.indexOf(e.id)});return o.resolve(i.map(c,function(e){return a.applyUpdateEntity(n,e),new r.classEntity(e,r)}))}return o.resolve([])})}},{key:"deleteOne",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.ensureCollectionExists(e);return this.findOne(e,t,r).then(function(e){return a.items=i.reject(a.items,function(t){return t.id===e.idHash[n.name]}),o.resolve()})}},{key:"deleteMany",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.ensureCollectionExists(e);return this.findMany(e,t,r).then(function(e){var t=i.map(e,function(e){return i.get(e,"idHash."+n.name)});return a.items=i.reject(a.items,function(e){return i.includes(t,e.id)}),o.resolve()})}}]),t}();t.exports=c},{"../../dependencies":9,"../../diaspora":10,"../../utils":18,"./entity.js":6}],6:[function(e,t,n){"use strict";var r=e("../base/entity.js"),i=function(e){function t(e,n){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return _inherits(t,r),t}();t.exports=i},{"../base/entity.js":4}],7:[function(e,t,n){(function(n){"use strict";var r=e("../../dependencies"),i=r._,o=r.Promise,a=e("../../utils"),s=e("../../diaspora").components.Adapters.Adapter,u=e("./entity"),c=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,u));return i.defaults(e,{session:!1}),r.state="ready",r.source=!0===e.session?n.sessionStorage:n.localStorage,r}return _inherits(t,s),_createClass(t,[{key:"configureCollection",value:function(e,n){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"configureCollection",this).call(this,e,n),this.ensureCollectionExists(e)}},{key:"ensureCollectionExists",value:function(e){var t=this.source.getItem(e);return i.isNil(t)?(t=[],this.source.setItem(e,JSON.stringify(t))):t=JSON.parse(t),t}},{key:"getItemName",value:function(e,t){return e+".id="+t}},{key:"insertOne",value:function(e,t){(t=i.cloneDeep(t||{})).id=a.generateUUID(),this.setIdHash(t);try{var n=this.ensureCollectionExists(e);n.push(t.id),this.source.setItem(e,JSON.stringify(n)),this.source.setItem(this.getItemName(e,t.id),JSON.stringify(t))}catch(e){return o.reject(e)}return o.resolve(new this.classEntity(t,this))}},{key:"insertMany",value:function(e,t){var n=this;t=i.cloneDeep(t);try{var r=this.ensureCollectionExists(e);t=t.map(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.id=a.generateUUID(),n.setIdHash(t),r.push(t.id),n.source.setItem(n.getItemName(e,t.id),JSON.stringify(t)),new n.classEntity(t,n)}),this.source.setItem(e,JSON.stringify(r))}catch(e){return o.reject(e)}return o.resolve(t)}},{key:"findOneById",value:function(e,t){var n=this.source.getItem(this.getItemName(e,t));return i.isNil(n)?o.resolve():o.resolve(new this.classEntity(JSON.parse(n),this))}},{key:"findOne",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i.defaults(r,{skip:0}),!i.isObject(t))return this.findOneById(e,t);if(i.isEqual(i.keys(t),["id"])&&i.isEqual(i.keys(t.id),["$equal"]))return this.findOneById(e,t.id.$equal);var a=this.ensureCollectionExists(e),s=void 0,u=0;return i.each(a,function(i){var o=JSON.parse(n.source.getItem(n.getItemName(e,i)));if(n.matchEntity(t,o)&&++u>r.skip)return s=o,!1}),o.resolve(i.isNil(s)?void 0:new this.classEntity(s,this))}},{key:"updateOne",value:function(e,t,n,r){var s=this;return i.defaults(r,{skip:0}),this.findOne(e,t,r).then(function(t){if(i.isNil(t))return o.resolve();a.applyUpdateEntity(n,t);try{return s.source.setItem(s.getItemName(e,t.id),JSON.stringify(t)),o.resolve(t)}catch(e){return o.reject(e)}})}},{key:"deleteOne",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.findOne(e,t,r).then(function(t){try{var r=n.ensureCollectionExists(e);i.pull(r,t.id),n.source.setItem(e,JSON.stringify(r)),n.source.removeItem(n.getItemName(e,t.id))}catch(e){return o.reject(e)}return o.resolve()})}},{key:"deleteMany",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return this.findMany(e,t,r).then(function(t){var r=n.ensureCollectionExists(e);return i.pullAll(r,i.map(t,"id")),n.source.setItem(e,JSON.stringify(r)),i.forEach(t,function(t){n.source.removeItem(n.getItemName(e,t.id))}),o.resolve()})}catch(e){return o.reject(e)}}}]),t}();t.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../dependencies":9,"../../diaspora":10,"../../utils":18,"./entity":8}],8:[function(e,t,n){"use strict";var r=e("../base/entity.js"),i=function(e){function t(e,n){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return _inherits(t,r),t}();t.exports=i},{"../base/entity.js":4}],9:[function(e,t,n){(function(n){"use strict";t.exports={_:n._||e("lodash"),SequentialEvent:n.SequentialEvent||e("sequential-event"),Promise:n.Promise&&n.Promise.version?n.Promise:e("bluebird")}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bluebird:void 0,lodash:void 0,"sequential-event":void 0}],10:[function(e,t,n){(function(n){"use strict";var r=e("./dependencies"),i=r._,o=r.Promise,a=function(){if(n.browser)return console;var t=e("winston"),r=t.createLogger({level:"silly",format:t.format.json(),transports:[]});return"production"!==n.env.NODE_ENV&&r.add(new t.transports.Console({format:t.format.simple()})),r}(),s={},u={},c={},l=function(e,t){var n=function(n){return(n=e.remapOutput(t,n))instanceof e.classEntity||i.isNil(n)?n:new e.classEntity(n,e)};return function(e){return i.isNil(e)?o.resolve():i.isArrayLike(e)?o.resolve(i.map(e,n)):o.resolve(n(e))}},f=function(e,t,n,r,o){!1!==t?(!0===e[t].remapInput&&(e[0]=o(e[0]),!0===n&&(e[1]=o(e[1]))),e[t].remapInput=!1):"insert"===r.query&&("many"===r.number?e[0]=i.map(e[0],function(e){return o(e)}):e[0]=o(e[0]))},d=function(e,t){return function(n){return e.remapInput(t,n)}},p=function(e,t,n){return function(r){for(var i=arguments.length,a=Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];var u=!1,c=!1;["find","delete"].indexOf(t.query)>=0?u=1:"update"===t.query&&(u=2,c=!0);try{!1!==u&&(a[u]=n.normalizeOptions(a[u]),a[0]=n.normalizeQuery(a[0],a[u])),f(a,u,c,t,d(n,r))}catch(e){return o.reject(e)}return e.call.apply(e,[n,r].concat(a)).then(l(n,r))}},h={NON_EMPTY_STR:i.template('<%= c %> <%= p %> must be a non empty string, had "<%= v %>"')},y=function(e,t){if(!i.isString(t)&&t.length>0)throw new Error(h.NON_EMPTY_STR({c:e,p:"name",v:t}))},v={default:function(e,t){var n=this;return i.defaults(e,i.mapValues(t,function(t,r){return n.defaultField(e[r],t)}))},defaultField:function(e,t){var n=void 0;return n=i.isUndefined(e)?i.isFunction(t.default)?t.default():t.default:e,"object"===t.type&&i.isObject(t.attributes)&&i.keys(t.attributes).length>0&&!i.isNil(n)?this.default(n,t.attributes):n},createDataSource:function(t,n){if(!s.hasOwnProperty(t))try{e("diaspora-"+t)}catch(e){throw new Error('Unknown adapter "'+t+'". Available currently are '+Object.keys(s).join(", ")+". Additionnaly, an error was thrown: "+e)}var r=new s[t](n);return new Proxy(r,{get:function(e,t){if(i.isString(t)){var n=t.match(/^(find|update|insert|delete)(Many|One)$/);if(null!==n)return n[2]=n[2].toLowerCase(),n=i.mapKeys(n.slice(0,3),function(e,t){return["full","query","number"][t]}),p(e[t],n,e)}return e[t]}})},registerDataSource:function(e,t){if(y("DataSource",e),u.hasOwnProperty(e))throw new Error('DataSource name already used, had "'+e+'"');return t.name=e,i.merge(u,_defineProperty({},e,t)),t},createNamedDataSource:function(e,t,n){var r=v.createDataSource(t,n);return v.registerDataSource(e,r)},declareModel:function(e,t){if(!i.isString(e)&&e.length>0&&y("Model",e),!i.isObject(t))throw new Error('"modelDesc" must be an object');var n=new v.components.Model(e,t);return i.assign(c,_defineProperty({},e,n)),n},registerAdapter:function(e,t){if(s.hasOwnProperty(e))throw new Error('Adapter with label "'+e+'" already exists.');s[e]=t},models:c,dataSources:u,adapters:s,dependencies:r,logger:a};t.exports=v,v.components={Errors:{ExtendableError:e("./errors/extendableError"),EntityValidationError:e("./errors/entityValidationError"),SetValidationError:e("./errors/setValidationError"),EntityStateError:e("./errors/entityStateError")}},i.assign(v.components,{Adapters:{Adapter:e("./adapters/base/adapter"),Entity:e("./adapters/base/entity")}}),i.assign(v.components,{Model:e("./model"),EntityFactory:e("./entityFactory"),Entity:e("./entityFactory").Entity,Set:e("./set"),Validator:e("./validator")}),v.registerAdapter("inMemory",e("./adapters/inMemory/adapter")),n.browser&&v.registerAdapter("webStorage",e("./adapters/webStorage/adapter"))}).call(this,e("_process"))},{"./adapters/base/adapter":3,"./adapters/base/entity":4,"./adapters/inMemory/adapter":5,"./adapters/webStorage/adapter":7,"./dependencies":9,"./entityFactory":11,"./errors/entityStateError":12,"./errors/entityValidationError":13,"./errors/extendableError":14,"./errors/setValidationError":15,"./model":16,"./set":17,"./validator":19,_process:20,winston:void 0}],11:[function(e,t,n){"use strict";var r=e("./dependencies"),i=r._,o=r.Promise,a=r.SequentialEvent,s=e("./diaspora"),u=s.components.Adapters.Entity,c=e("./errors/entityStateError"),l={skipEvents:!1},f=Symbol("PRIVATE"),d=function e(t,n,r,a){return a=i.castArray(a),n.skipEvents?o.resolve(t):t.emit.apply(t,[a[0]].concat(_toConsumableArray(r))).then(function(){return a.length>1?e(t,n,r,i.slice(a,1)):o.resolve(t)})},p=function(e,t,n,r){return function(){return"orphan"===t?o.reject(new c("Can't fetch an orphan entity.")):(e[f].lastDataSource=n.name,n[r](e.table(n.name),e.uidQuery(n)))}},h={bindLifecycleEvents:function(e,t){i.forEach(t.lifecycleEvents,function(t,n){i.forEach(i.castArray(t),function(t){e.on(n,t)})})},loadSource:function(e,t){if(t instanceof u){var n=e[f];i.assign(n,{state:"sync",lastDataSource:t.dataSource.name}),n.dataSources[n.lastDataSource]=t,t=e.deserialize(i.omit(t.toObject(),["id"]))}return t}},y=function(e){function t(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,t);var a=i.keys(n.attributes),u=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),c={state:"orphan",lastDataSource:null,dataSources:Object.seal(i.mapValues(r.dataSources,function(){})),name:e,modelDesc:n,model:r};u[f]=c,o=h.loadSource(u,o);var l=i.difference(o,a);if(0!==l.length)throw new Error("Source has unknown keys: "+JSON.stringify(l)+" in "+JSON.stringify(o));return c.attributes=s.default(i.cloneDeep(o),n.attributes),o=null,h.bindLifecycleEvents(u,n),u}return _inherits(t,a),_createClass(t,[{key:"uidQuery",value:function(e){return{id:this[f].attributes.idHash[e.name]}}},{key:"table",value:function(){return this[f].name}},{key:"validate",value:function(){this.constructor.model.validator.validate(this[f].attributes)}},{key:"replaceAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.idHash=this[f].attributes.idHash,this[f].attributes=e,this}},{key:"getDiff",value:function(e){var t=this,n=this[f].dataSources[e.name].toObject(),r=i(this[f].attributes).keys().concat(i.keys(n)).uniq().difference(["idHash"]).value(),o=i(r).filter(function(e){return t[f].attributes[e]!==n[e]}).map(function(e){return t[f].attributes[e]}).value();return i.zipObject(r,o)}},{key:"toObject",value:function(){return this[f].attributes}},{key:"serialize",value:function(e){return i.cloneDeep(e)}},{key:"deserialize",value:function(e){return i.cloneDeep(e)}},{key:"persist",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.defaults(n,l);var r=this[f].state;this[f].state="syncing";var o=this.constructor.model.getDataSource(e),a=[o.name],s=i.partial(d,this,n,a),u="orphan"===r?"Create":"Update";return s(["beforePersist","beforeValidate"]).then(function(){return t.validate()}).then(function(){return s(["afterValidate","beforePersist"+u])}).then(function(){return t[f].lastDataSource=o.name,"orphan"===r?o.insertOne(t.table(e),t.toObject()):o.updateOne(t.table(e),t.uidQuery(o),t.getDiff(o))}).then(function(e){return t[f].state="sync",t[f].attributes=e.toObject(),t[f].dataSources[o.name]=e,s(["afterPersist"+u,"afterPersist"])})}},{key:"fetch",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.defaults(n,l);var r=this[f].state;this[f].state="syncing";var o=this.constructor.model.getDataSource(e),a=[o.name,this.serialize(this[f].attributes)],s=i.partial(d,this,n,a);return s("beforeFetch").then(p(this,r,o,"findOne")).then(function(e){return t[f].state="sync",t[f].attributes=e.toObject(),t[f].dataSources[o.name]=e,s("afterFetch")})}},{key:"destroy",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.defaults(n,l);var r=this[f].state;this[f].state="syncing";var o=this.constructor.model.getDataSource(e),a=[o.name],s=i.partial(d,this,n,a);return s("beforeDestroy").then(p(this,r,o,"deleteOne")).then(function(){return 0===i.without(t[f].model.dataSources,o.name).length?t[f].state="orphan":(t[f].state="sync",delete t[f].attributes.idHash[o.name]),t[f].dataSources[o.name]=void 0,s("afterDestroy")})}},{key:"dataSources",get:function(){return this[f].dataSources}},{key:"attributes",get:function(){return this[f].attributes}},{key:"state",get:function(){return this[f].state}},{key:"lastDataSource",get:function(){return this[f].lastDataSource}}]),t}(),v=function(e,t,n){var r=function(t){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,y),_createClass(r,null,[{key:"name",get:function(){return e+"Entity"}},{key:"model",get:function(){return n}}]),r}();return i.forEach(t.methods,function(e,t){r.prototype[t]=e}),i.forEach(t.staticMethods,function(e,t){r[e]=t}),r.bind(r,e,t,n)};v.Entity=y,t.exports=v},{"./dependencies":9,"./diaspora":10,"./errors/entityStateError":12}],12:[function(e,t,n){"use strict";var r=e("./extendableError"),i=function(e){function t(){var e;_classCallCheck(this,t);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return _possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)))}return _inherits(t,r),t}();t.exports=i},{"./extendableError":14}],13:[function(e,t,n){"use strict";var r=e("../dependencies")._,i=e("./extendableError"),o=function(e){return r(e).mapValues(function(e,t){return t+" => "+JSON.stringify(e.value)+"\n* "+r(e).omit(["value"]).values().map(r.identity).value()}).values().join("\n* ")},a=function(e){function t(e,n){var r;_classCallCheck(this,t),n+="\n"+o(e);for(var i=arguments.length,a=Array(i>2?i-2:0),s=2;s<i;s++)a[s-2]=arguments[s];var u=_possibleConstructorReturn(this,(r=t.__proto__||Object.getPrototypeOf(t)).call.apply(r,[this,n].concat(a)));return u.validationErrors=e,u}return _inherits(t,i),t}();t.exports=a},{"../dependencies":9,"./extendableError":14}],14:[function(e,t,n){"use strict";var r=function(e){function t(e){var n;_classCallCheck(this,t);for(var r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var a=_possibleConstructorReturn(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,e].concat(i)));return"function"==typeof Error.captureStackTrace?Error.captureStackTrace(a,_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"target",a)):a.stack=new Error(e).stack,a}return _inherits(t,Error),t}();t.exports=r},{}],15:[function(e,t,n){"use strict";var r=e("../dependencies")._,i=e("./extendableError"),o=function(e){function t(e,n){var i;_classCallCheck(this,t),e+="[\n"+r(n).map(function(e,t){return!r.isNil(e)&&t+": "+e.message.replace(/\n/g,"\n\t")}).filter(r.identity).join(",\n")+"\n]";for(var o=arguments.length,a=Array(o>2?o-2:0),s=2;s<o;s++)a[s-2]=arguments[s];var u=_possibleConstructorReturn(this,(i=t.__proto__||Object.getPrototypeOf(t)).call.apply(i,[this,e].concat(a)));return u.validationErrors=n,u}return _inherits(t,i),t}();t.exports=o},{"../dependencies":9,"./extendableError":14}],16:[function(e,t,n){"use strict";var r=e("./dependencies"),i=r._,o=r.Promise,a=e("./entityFactory"),s=e("./diaspora"),u=e("./set"),c=e("./validator"),l=a.entityPrototypeProperties,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3],o=void 0;return o=i.isString(n)&&i.isNil(r)?{dataSourceName:n,options:{}}:i.isString(t)&&i.isNil(n)&&i.isNil(r)?{dataSourceName:t,queryFind:{},options:{}}:{queryFind:t,options:n,dataSourceName:r},o.dataSource=e.getDataSource(o.dataSourceName),o},d=function(e){return function(t){var n=i.map(t,function(t){return new e.entityFactory(t)}),r=new u(e,n);return o.resolve(r)}},p=function(e){return function(t){if(i.isNil(t))return o.resolve();var n=new e.entityFactory(t);return o.resolve(n)}},h=function(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2],o=f(t,n,r,i);return o.dataSource[e](t.name,o.queryFind,o.options)}},y=function(e,t,n,r,o,a){var s,u=f(e,n,r,o),c=i([e.name,u.queryFind]).push(a).push(u.options).compact().value();return(s=u.dataSource)[(a?"update":"find")+(t?"Many":"One")].apply(s,_toConsumableArray(c)).then((t?d:p)(e))},v=function(e){var t=e.sources;return t=i.isString(t)?_defineProperty({},e.sources,!0):i.isArrayLike(t)?i.zipObject(t,i.times(t.length,i.constant({}))):i.mapValues(t,function(e,t){if(!0===e)return{};if(i.isObject(e))return e;throw new TypeError('Datasource "'+t+'" value is invalid: expect `true` or a remap hash, but have '+JSON.stringify(e))})},m=function(){function e(t,n){_classCallCheck(this,e);var r=i.intersection(l,i.keys(n.attributes));if(0!==r.length)throw new Error(JSON.stringify(r)+" is/are reserved property names. To match those column names in data source, please use the data source mapper property");if(!n.hasOwnProperty("sources")||!i.isArrayLike(n.sources)&&!i.isObject(n.sources))throw new TypeError("Expect model sources to be either an array or an object, had "+JSON.stringify(n.sources)+".");var o=v(n),u=[i.keys(o),s.dataSources],f=u[0],d=u[1],p=i.pick(d,f),h=i.difference(f,i.keys(p));if(0!==h.length)throw new Error("Missing data sources "+h.map(function(e){return'"'+e+'"'}).join(", "));i.forEach(o,function(e,n){p[n].configureCollection(t,e)}),i.assign(this,{dataSources:p,defaultDataSource:f[0],name:t,entityFactory:a(t,n,this),validator:new c(n.attributes)})}return _createClass(e,[{key:"getDataSource",value:function(e){if(i.isNil(e))e=this.defaultDataSource;else if(!this.dataSources.hasOwnProperty(e))throw new Error('Unknown data source "'+e+'" in model "'+this.name+'", available are '+i.keys(this.dataSources).map(function(e){return'"'+e+'"'}).join(", "));return this.dataSources[e]}},{key:"spawn",value:function(e){return new this.entityFactory(e)}},{key:"spawnMany",value:function(e){var t=this;return new u(this,i.map(e,function(e){return t.spawn(e)}))}},{key:"insert",value:function(e,t){var n=this;return this.getDataSource(t).insertOne(this.name,e).then(function(e){return o.resolve(new n.entityFactory(e))})}},{key:"insertMany",value:function(e,t){return this.getDataSource(t).insertMany(this.name,e).then(d(this))}},{key:"find",value:function(e,t,n){return y(this,!1,e,t,n)}},{key:"findMany",value:function(e,t,n){return y(this,!0,e,t,n)}},{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];return y(this,!1,e,n,r,t)}},{key:"updateMany",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];return y(this,!0,e,n,r,t)}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];return h("deleteOne",this)(e,t,n)}},{key:"deleteMany",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];return h("deleteMany",this)(e,t,n)}}]),e}();t.exports=m},{"./dependencies":9,"./diaspora":10,"./entityFactory":11,"./set":17,"./validator":19}],17:[function(e,t,n){"use strict";function r(e,t,n){var r=this,i=o.partial(l,this.entities,n);return i("before").then(function(){return a.all(r.entities.map(function(n){return n[t](e,{skipEvents:!0})}))}).then(function(){return i("after")})}var i=e("./dependencies"),o=i._,a=i.Promise,s=e("./utils"),u=e("./errors/setValidationError"),c=function(e,t){return o.isArray(e)?e[t]:e},l=function(e,t,n){return a.all(e.map(function(e,r){return e.emit(""+n+c(t,r))}))},f={get:function(e,t){return t in e?e[t]:t in e.entities?e.entities[t]:"string"==typeof t&&t.match(/^-?\d+$/)&&e.entities.nth(parseInt(t))?e.entities.nth(parseInt(t)):void 0},set:function(e,t,n){if("model"===t)return new Error('Can\'t assign to read-only property "model".');"entities"===t&&(d.checkEntitiesFromModel(n,e.model),e.entities=o(n))}},d=function(){function e(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];_classCallCheck(this,e),r=o(r).flatten(),e.checkEntitiesFromModel(r.value(),t);var a=s.defineEnumerableProperties(this,{entities:r,model:t,length:{get:function(){return this.entities.size()}}});return new Proxy(a,f)}return _createClass(e,[{key:"persist",value:function(e){var t=this,n=this.entities.map(function(e){return"orphan"===e.state?"Create":"Update"}).value(),i=o.partial(l,this.entities);return i("Persist","before").then(function(){return i("Validate","before")}).then(function(){var e=0,n=t.entities.map(function(t){try{return void t.validate()}catch(t){return e++,t}}).value();return e>0?a.reject(new u("Set validation failed for "+e+" elements (on "+t.length+"): ",n)):a.resolve()}).then(function(){return i("Validate","after")}).then(function(){return r.call(t,e,"persist",o.map(n,function(e){return"Persist"+e}))}).then(function(){return i("Persist","after")}).then(function(){return t})}},{key:"fetch",value:function(e){var t=this;return r.call(this,e,"fetch","Fetch").then(function(){return t})}},{key:"destroy",value:function(e){var t=this;return r.call(this,e,"destroy","Destroy").then(function(){return t})}},{key:"update",value:function(e){return this.entities.forEach(function(t){s.applyUpdateEntity(e,t)}),this}},{key:"toObject",value:function(){return this.entities.map(function(e){return e.toObject()}).value()}}],[{key:"checkEntitiesFromModel",value:function(e,t){e.forEach(function(e,n){if(e.constructor.model!==t)throw new TypeError("Provided entity nÂ°"+n+" "+e+" is not from model "+t+" ("+t.modelName+")")})}}]),e}();t.exports=d},{"./dependencies":9,"./errors/setValidationError":15,"./utils":18}],18:[function(e,t,n){(function(n){"use strict";var r=e("./dependencies")._;t.exports={defineEnumerableProperties:function(e,t){var n=r.mapValues(t,function(e){(r.isNil(e)||"object"!==(void 0===e?"undefined":_typeof(e))||Object.getPrototypeOf(e)!==Object.prototype)&&(e={value:e});var t={enumerable:!0};return e.hasOwnProperty("get")||(t.writable=!1),r.defaults(e,t),e});return Object.defineProperties(e,n)},applyUpdateEntity:function(e,t){return r.forEach(e,function(e,n){r.isUndefined(e)?delete t[n]:t[n]=e}),t},generateUUID:function(){var e=(new Date).getTime();return n.performance&&"function"==typeof n.performance.now&&(e+=n.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})},applyOptionsToSet:function(e,t){return r.defaults(t,{limit:1/0,skip:0}),(e=e.slice(t.skip)).length>t.limit&&(e=e.slice(0,t.limit)),e}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./dependencies":9}],19:[function(e,t,n){"use strict";var r=e("./dependencies"),i=e("./diaspora").components.Errors.EntityValidationError,o=r._,a=function(e){return function(t,n,r){if(!e(r))return{type:t.toValidatePath()+' expected to be a "'+n.type+'"'}}},s=function(e,t,n){return function(r,i){if(t.hasOwnProperty("of")){var a=o.castArray(t.of),s=o(a).map(function(a,s){return e.check(r,n.clone().pushValidationProp("of",o.isArray(t.of)?s:void 0).pushEntityProp(i),{getProps:!1})});if(!o.isArray(t.of))return s.get(0);if(s.compact().value().length===a.length)return s.toPlainObject().omitBy(o.isNil).value()}return{}}},u={TYPE:{string:a(o.isString),integer:a(o.isInteger),float:a(o.isNumber),date:a(o.isDate),object:function(e,t,n){var r=this;if(!o.isObject(n))return{type:e.toValidatePath()+' expected to be a "'+t.type+'"'};var i=o.isObject(t.attributes)?o(o.assign({},t.attributes,n)).mapValues(function(t,i){var o=n[i];return r.check(o,e.clone().pushValidationProp("attributes").pushProp(i),{getProps:!1})}).omitBy(o.isEmpty).value():{};return o.isEmpty(i)?void 0:{children:i}},array:function(e,t,n){if(!o.isArray(n))return{type:e.toValidatePath()+' expected to be a "'+t.type+'"'};var r=o.isObject(t.of)?o(n).map(s(this,t,e)).omitBy(o.isEmpty).value():{};return o.isEmpty(r)?void 0:{children:r}},any:function(e,t,n){if(!o.stubTrue(n))return{type:e.toValidatePath()+" expected to be assigned with any type"}},_:function(e,t){return{type:e.toValidatePath()+' requires to be unhandled type "'+t.type+'"'}}}},c=[function(e){var t=this,n=e.error,r=e.fieldDesc,i=e.keys,a=e.value;o(r.validate).castArray().compact().forEach(function(e){e.call(t,a,r)||(n.validate=i.toValidatePath()+" custom validation failed")})},function(e){var t=e.error,n=e.fieldDesc,r=e.keys,i=e.value;if(o.isNil(n.type)||o.isNil(n.model)){if(!0===n.required&&o.isNil(i))t.required=r.toValidatePath()+' is a required property of type "'+n.type+'"';else if(!o.isNil(i))if(o.isString(n.type)){var a=o.get(u,["TYPE",n.type],n.type._);o.assign(t,a.call(this,r,n,i))}else t.spec=r.toValidatePath()+' spec "type" must be a string'}else t.spec=r.toValidatePath()+" spec can't have both a type and a model"},function(e){var t=e.error,n=e.fieldDesc,r=e.keys,i=e.value;o.isNil(i)||o.isNil(n.enum)||!1===o.some(n.enum,function(e){return e instanceof RegExp?null!==i.match(e):i===e})&&(t.enum=r.toValidatePath()+' expected to have one of enumerated values "'+JSON.stringify(n.enum)+'"')}],l=Symbol("PRIVATE"),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,e),o.assign(this,{segmentsEntity:t,segmentsValidation:n})}return _createClass(e,[{key:"pushEntityProp",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.segmentsEntity=o(this.segmentsEntity).concat(t).filter(o.isNil).value(),this}},{key:"pushValidationProp",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.segmentsValidation=o(this.segmentsValidation).concat(t).filter(function(e){return!o.isNil(e)}).value(),this}},{key:"pushProp",value:function(){var e;return(e=this.pushEntityProp.apply(this,arguments)).pushValidationProp.apply(e,arguments)}},{key:"toValidatePath",value:function(){return this.segmentsEntity.join(".")}},{key:"toArray",value:function(){return[this.segmentsEntity.slice(),this.segmentsValidation.slice()]}},{key:"clone",value:function(){return new(Function.prototype.bind.apply(e,[null].concat(_toConsumableArray(this.toArray()))))}}]),e}(),d=function(){function e(t){_classCallCheck(this,e);var n={modelDesc:t};this[l]=n}return _createClass(e,[{key:"validate",value:function(e){var t=this,n=o(this[l].modelDesc).mapValues(function(n,r){return t.check(e[r],(new f).pushProp(r),{getProps:!1})}).omitBy(o.isEmpty).value();if(!o.isNil(n)&&!o.isEmpty(n))throw new i(n,"Validation failed")}},{key:"check",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o.defaults(r,{getProps:!0}),t instanceof f||(t=new f(t));var i=r.getProps?o.get(e,t.segmentsEntity):e,a=o.get(this[l].modelDesc,t.segmentsValidation);if(o.isObject(a)){o.defaults(a,{required:!1});var s={},u={error:s,fieldDesc:a,keys:t,value:i};return o.forEach(c,function(e){return e.call(n,u)}),o.isEmpty(s)?null:(s.value=e,s)}}},{key:"modelDesc",get:function(){return o.cloneDeep(this[l].modelDesc)}}],[{key:"PathStack",get:function(){return f}}]),e}();t.exports=d},{"./dependencies":9,"./diaspora":10}],20:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(d===clearTimeout)return clearTimeout(e);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function s(){v&&h&&(v=!1,h.length?y=h.concat(y):m=-1,y.length&&u())}function u(){if(!v){var e=o(s);v=!0;for(var t=y.length;t;){for(h=y,y=[];++m<t;)h&&h[m].run();m=-1,t=y.length}h=null,v=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,d,p=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(e){d=i}}();var h,y=[],v=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];y.push(new c(e,t)),1!==y.length||v||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.prependListener=l,p.prependOnceListener=l,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}]},{},[1])(1)});
//# sourceMappingURL=diaspora.min.js.map